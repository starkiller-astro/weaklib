WL_GIT_HASH := $(shell git --no-pager describe --tags --always --dirty --exclude '*')
WL_GIT_DATE := $(firstword $(shell git --no-pager show --date=short --format="%ad" --name-only))
WL_GIT_BRANCH := $(shell git branch | grep "^\*" | sed 's/^..//')
WL_GIT_URL :=$(shell git config --get remote.origin.url)

WL_VERSION_FLAGS := -DWL_GIT_HASH="\"$(WL_GIT_HASH)\"" -DWL_GIT_DATE="\"$(WL_GIT_DATE)\"" -DWL_GIT_BRANCH="\"$(WL_GIT_BRANCH)\"" -DWL_GIT_URL="\"$(WL_GIT_URL)\""

include $(WEAKLIB_DIR)/Distributions/Build/Machines/Makefile_$(MACHINE)

FLAGS_$(OPT_LEVEL) = $($(OPT_LEVEL)) $(OPENMP) $(OPENACC) $(WL_VERSION_FLAGS)

INCLUDE            = $(INCLUDE_HDF5)
LIBRARIES          = $(LIBRARIES_HDF5)

ifeq ($(USE_GPU),TRUE)
    ifeq ($(USE_CUDA),TRUE)
        INCLUDE   += $(INCLUDE_CUDA)
        LIBRARIES += $(LIBRARIES_CUDA)
    else ifeq ($(USE_HIP),TRUE)
        INCLUDE   += $(INCLUDE_ROCM)
        LIBRARIES += $(LIBRARIES_ROCM)
    endif
endif
