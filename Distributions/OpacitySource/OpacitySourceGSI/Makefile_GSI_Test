WEAKLIB_DIR ?= $(HOME)/weaklib
include $(WEAKLIB_DIR)/Distributions/Build/Makefile_Build
include $(WEAKLIB_DIR)/Distributions/Build/Makefile_WeakLib_ObjectFiles
include $(WEAKLIB_DIR)/Distributions/Build/Makefile_WeakLib_Dependencies

CUBA_LIB = -L$(CUBA_DIR) -lcuba

.DEFAULT_GOAL := all

all: wlTestGSI \
     wlTestGSI2D \
     wlTestSpeed \
     wlTestParallel2DGSI

wlTestGSI: \
	$(weaklib) Opacity_SemiLep_2D_GSI.o Opacity_SemiLep_4D_GSI.o wlTestGSI.o
	$(FLINKER) $(FLAGS) -o wlTestGSI_$(MACHINE) \
	$(weaklib) Opacity_SemiLep_2D_GSI.o Opacity_SemiLep_4D_GSI.o wlTestGSI.o \
	$(LIBRARIES) $(CUBA_LIB)

wlTestGSI2D: \
	$(weaklib) Opacity_SemiLep_2D_GSI.o wlTestGSI2D.o
	$(FLINKER) $(FLAGS) -o wlTestGSI2D_$(MACHINE) \
	$(weaklib) Opacity_SemiLep_2D_GSI.o wlTestGSI2D.o \
	$(LIBRARIES) $(CUBA_LIB)

wlTestSpeed: \
	$(weaklib) Opacity_SemiLep_2D_GSI.o Opacity_SemiLep_4D_GSI.o wlTestSpeed.o
	$(FLINKER) $(FLAGS) -o wlTestSpeed_$(MACHINE) \
	$(weaklib) Opacity_SemiLep_2D_GSI.o Opacity_SemiLep_4D_GSI.o wlTestSpeed.o \
	$(LIBRARIES) $(CUBA_LIB)

wlTestParallel2DGSI: \
	$(weaklib) wlTestParallel2DGSI.o
	$(FLINKER) $(FLAGS) -o wlTestParallel2DGSI_$(MACHINE) \
	$(weaklib) wlTestParallel2DGSI.o \
	$(LIBRARIES) $(CUBA_LIB)

wlTestParallel4DGSI: \
	$(weaklib) wlTestParallel4DGSI.o
	$(FLINKER) $(FLAGS) -o wlTestParallel4DGSI_$(MACHINE) \
	$(weaklib) wlTestParallel4DGSI.o \
	$(LIBRARIES) $(CUBA_LIB)

clean:
	rm -f *.o *.mod *.ld *.acc.s

clobber: clean
	rm -f *_$(MACHINE)

wlTestGSI.o: \
	wlKindModule.o \
	wlSemiLeptonicOpacityModule2D.o \
	wlSemiLeptonicOpacityModule4D.o \
	Opacity_SemiLep_2D_GSI.o \
	Opacity_SemiLep_4D_GSI.o

wlTestGSI2D.o: \
	wlKindModule.o \
	wlSemiLeptonicOpacityModule2D.o \
	Opacity_SemiLep_2D_GSI.o

wlTestSpeed.o: \
	wlKindModule.o \
  wlKindModule.o \
  wlEosConstantsModule.o \
  wlInterpolationModule.o \
  wlEquationOfStateTableModule.o \
  wlIOModuleHDF.o \
  wlEOSIOModuleHDF.o \
  wlLeptonEOSModule.o \
  wlMuonEOS.o \
  wlElectronPhotonEOS.o \
  wlHelmMuonIOModuleHDF.o \
	wlOpacityTableModule.o \
	wlOpacityTableIOModuleHDF.o \
	wlOpacityFieldsModule.o

wlTestParallel2DGSI.o: \
	wlKindModule.o \
	wlSemiLeptonicOpacityModule2D.o \
	wlEosConstantsModule.o

wlTestParallel4DGSI.o: \
	wlKindModule.o \
	wlSemiLeptonicOpacityModule4D.o \
	wlEosConstantsModule.o